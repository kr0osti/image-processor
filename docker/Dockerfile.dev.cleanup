FROM alpine:3.19

# Install dependencies
RUN apk add --no-cache curl bash

# Create app directory
WORKDIR /app

# Create uploads directory
RUN mkdir -p /app/public/uploads

# Copy cleanup script
COPY scripts/cleanup.sh /app/cleanup.sh
RUN chmod +x /app/cleanup.sh

# Set up cron job to run cleanup every minute
RUN echo "* * * * * /app/cleanup.sh >> /var/log/cleanup.log 2>&1" > /etc/crontabs/root

# Create log file
RUN touch /var/log/cleanup.log && chmod 666 /var/log/cleanup.log

# Run crond in the foreground
CMD ["crond", "-f", "-d", "8"]
